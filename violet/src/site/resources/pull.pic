.PS
down
C: box "active" fill 0.1 rad 0.25
S: box "inactive" at C + (4,0) fill 0.1 rad 0.25
"\fB\f4\mkFile Requests\rt\ul\ul\ul\ul\ul\ul\ul\ul\ul\ul\ul\ul\ul" at C + (2,0.5) 
C1: box "request <id>" at C - (0,1) width 1.25
line from C.s to C1.n
S1: box "recv" at S - (0,1.5)
arrow from C1.e to S1.w dashed "FileRequest <id>" above  "" above
move to S1.s
arrow
S11: box "Mechanism 1" width 1.5 
S2: box "Mechanism 2" width 1.5 at S11 + (0, -2)
move to S11.s
line dotted down
" timeout" ljust
arrow " failed " ljust to S2.n
arrow from S11.w to S11 - (4,0.5) dashed "establishing transfer" above "of request <id>" below

C2: box "recv" at S2 - (4,0.5)
arrow from S2.w to C2.ne dashed "establishing transfer" above "of request <id>" below
S22: " established" ljust at S2 - (0,0.75)
arrow from C2.ne to S22 dashed "established transfer" below rjust
line dotted from S2.s to S22


C3: box "completed/failed" at C2 - (0,2) width 2
arrow dotted " watch transfer progress " ljust from C2.s to C3.n
S3: box "completed/failed" at C3 + (4,0) width 2
arrow dotted " watch transfer progress " rjust from S22.s to S3.n
move to C3.s
arrow to C3 + (0.75,-1) " completed" ljust above
C4: box "verify hash"
arrow " ok" ljust
C5: box "store"
move to C3.s
arrow to C3 + (-0.75,-2) "failed " rjust above
C6: box "re-request" 
arrow from C4.s to C6.ne " not ok" above rjust
.PE
